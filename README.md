# Nativescript OpenTok

[![npm](https://img.shields.io/npm/v/nativescript-opentok.svg?maxAge=2592000?style=plastic)](https://www.npmjs.com/package/nativescript-opentok) 
[![npm](https://img.shields.io/npm/dt/nativescript-opentok.svg?maxAge=2592000?style=plastic)](https://www.npmjs.com/package/nativescript-opentok)

A Nativescript plugin for the OpenTok iOS and (coming soon Android) SDK.

OpenTok: https://tokbox.com/developer/

## Getting Started

### Requirements
-  API Key with OpenTok. [Get one here](https://dashboard.tokbox.com/signups/new).
-  Ability to generate a valid session id (either through OpenTok account or back-end service)
-  Ability to generate a valid token (either through OpenTok account or back-end service)
-  Opentok.framework requires projects to be built for only armv7 (device); i386 (simulator), armv6, armv7s, and arm64 are not supported.

### Installation
Node Package Manager (NPM)

`npm install nativescript-opentok --save`

### Integration
The OpenTok integration leverages the following model to successfully integrated paired sessions.
# <img src="https://tokbox.com/developer/img/docs/publish_v2.jpeg" />


Import OpenTok nativescript plugin into your Nativescript page (i.e. main-page.ts) and set-up the local variables.
```
import {TNSOTSession} from 'nativescript-opentok';

...

private _apiKey: string = 'YOUR_API_KEY';
private _session: any;
```
Instantitate the `TNSOTSession` class, passing your OpenTok API key and the optional configuration object. 
```
this._session = new TNSOTSession(this._apiKey, {
    publisher: {
        videoLocationX: 240,
        videoLocationY: 200,
        videoWidth: 250,
        videoHeight: 250
    },
    subscriber: {
        videoLocationX: 800,
        videoLocationY: 200,
        videoWidth: 120,
        videoHeight: 120
    }
});
```
Initialize the session with a valid session id generated by your server implementation of OpenTok:
```
this._session.initSession(this.sessionId);
```

Refer to the above chart to understand the appropriate flow for a publisher versus a subscriber.

#### Publisher
```
private get publisherToken(): string {
    return 'INSERT_PUBLISHER_TOKEN';
}

this._session.connect(this.publisherToken);

this._session.sessionEvents.on('sessionDidConnect', (result) => {
    console.log('sessionConnected event');
});

this._session.sessionEvents.on('connectionCreated', () => {
    console.log('connectionCreated Event');
});

this._session.sessionEvents.on('streamCreated', () => {
    console.log('streamCreated event on session object');
});
```

#### Subscriber
```
private get subscriberToken(): string {
    return 'INSERT_SUBSCRIBER_TOKEN';
}

this._session.connect(this.subscriberToken);

this._session.sessionEvents.on('sessionDidConnect', (result) => {
    console.log('sessionConnected event');
    this._session.publish();
    this._session.publisherEvents.on('streamCreated', () => {
        console.log('streamCreated event on publisher object');
    });
});
```

### Images

# <img src="http://i.imgur.com/PxyZEFX.jpg" />

### Notes
- Publishing is not supported in the Simulator because it does not have access to your webcam. You may see a yellow tea-kettle instead.
- `TNS` stands for **T**elerik **N**ative**S**cript
